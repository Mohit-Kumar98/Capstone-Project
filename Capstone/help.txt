import pdfplumber

all_content=[]
content=[]
table_content=[]

def list_pdf_files_in_directory(directory_path):
    try:
        # List all files and directories in the given path
        files_and_dirs = os.listdir(directory_path)
        
        # Filter out directories and non-PDF files, keeping only PDF files
        pdf_files = [f for f in files_and_dirs if os.path.isfile(os.path.join(directory_path, f)) and f.lower().endswith('.pdf')]
        
        return pdf_files
    except FileNotFoundError:
        print(f"The directory {directory_path} does not exist.")
        return []


pdf_files = list_pdf_files_in_directory(DATA_PATH)



# Open the PDF file
for name in pdf_files:
    with pdfplumber.open(DATA_PATH+"/"+name) as pdf:
        for page_number, page in enumerate(pdf.pages):
            pg = page_number
            text = page.extract_text()
            source= name
            content.append({'page': pg+1,'text':text, 'source':source})
            res_in  = ""

            # Extract tables
            tables = page.extract_tables()
            # print(type(tables))
            # print("Tables:")
            for table in tables:
                res_in = ""
                for row in table:
                    res_in = res_in + ' '.join([str(r) for r in row])
                table_content.append({'page': pg+1,'text':res_in, 'source':source})
            # res_in = res_in + text
        all_content.extend(content)
        all_content.extend(table_content)


